/*! imgareaselect 1.0.0-rc.1 */ !function(a){function b(){return a("<div/>")}var c=Math.abs,d=Math.max,e=Math.min,f=Math.round;a.imgAreaSelect=function(g,h){function i(a){return a+vb.left-wb.left}function j(a){return a+vb.top-wb.top}function k(a){return a-vb.left+wb.left}function l(a){return a-vb.top+wb.top}function m(a){var b,c=o(a)||a;return(b=parseInt(c.pageX))?b-wb.left:void 0}function n(a){var b,c=o(a)||a;return(b=parseInt(c.pageY))?b-wb.top:void 0}function o(a){var b=a.originalEvent||{};return b.touches&&b.touches.length?b.touches[0]:!1}function p(a){var b=a||W,c=a||X;return{x1:f(zb.x1*b),y1:f(zb.y1*c),x2:f(zb.x2*b)-1,y2:f(zb.y2*c)-1,width:f(zb.x2*b)-f(zb.x1*b),height:f(zb.y2*c)-f(zb.y1*c)}}function q(a,b,c,d,e){var g=e||W,h=e||X;zb={x1:f(a/g||0),y1:f(b/h||0),x2:f(++c/g||0),y2:f(++d/h||0)},zb.width=zb.x2-zb.x1,zb.height=zb.y2-zb.y1}function r(){M&&pb.width()&&(vb={left:f(pb.offset().left),top:f(pb.offset().top)},P=pb.innerWidth(),Q=pb.innerHeight(),vb.top+=pb.outerHeight()-Q>>1,vb.left+=pb.outerWidth()-P>>1,Z=f(h.minWidth/W)||0,$=f(h.minHeight/X)||0,_=f(e(h.maxWidth/W||1<<24,P)),ab=f(e(h.maxHeight/X||1<<24,Q)),wb="fixed"==yb?{left:a(document).scrollLeft(),top:a(document).scrollTop()}:/static|^$/.test(R.css("position"))?{left:0,top:0}:{left:f(R.offset().left)-R.scrollLeft(),top:f(R.offset().top)-R.scrollTop()},N=i(0),O=j(0),(zb.x2>P||zb.y2>Q)&&B())}function s(b){if(cb){switch(qb.css({left:i(zb.x1),top:j(zb.y1)}).add(rb).width(mb=zb.width).height(nb=zb.height),rb.add(sb).add(ub).css({left:0,top:0}),sb.add(tb).width(d(mb-sb.outerWidth()+sb.innerWidth(),0)).height(d(nb-sb.outerHeight()+sb.innerHeight(),0)),tb.css({left:N,top:O,width:mb,height:nb,borderStyle:"solid",borderWidth:zb.y1+"px "+(P-zb.x2)+"px "+(Q-zb.y2)+"px "+zb.x1+"px"}),mb-=ub.outerWidth(),nb-=ub.outerHeight(),ub.length){case 8:a(ub[4]).css({left:mb>>1}),a(ub[5]).css({left:mb,top:nb>>1}),a(ub[6]).css({left:mb>>1,top:nb}),a(ub[7]).css({top:nb>>1});case 4:ub.slice(1,3).css({left:mb}),ub.slice(2,4).css({top:nb})}b!==!1&&(a.imgAreaSelect.keyPress!=Bb&&a(document).unbind(a.imgAreaSelect.keyPress,a.imgAreaSelect.onKeyPress),h.keys&&a(document)[a.imgAreaSelect.keyPress](a.imgAreaSelect.onKeyPress=Bb))}}function t(a){r(),s(a),db=i(zb.x1),eb=j(zb.y1),fb=i(zb.x2),gb=j(zb.y2)}function u(a,b){h.fadeDuration?a.fadeOut(h.fadeDuration,b):a.hide()}function v(a){return hb&&!/^touch/.test(a.type)}function w(a){var b=k(m(a))-zb.x1,c=l(n(a))-zb.y1;Y="",h.resizable&&(c<=h.resizeMargin?Y="n":c>=zb.height-h.resizeMargin&&(Y="s"),b<=h.resizeMargin?Y+="w":b>=zb.width-h.resizeMargin&&(Y+="e")),qb.css("cursor",Y?Y+"-resize":h.movable?"move":"")}function x(a){v(a)||(ob||(r(),ob=!0,qb.one("mouseout",function(){ob=!1})),w(a))}function y(b){hb=!1,a("body").css("cursor",""),(h.autoHide||zb.width*zb.height==0)&&u(qb.add(tb),function(){a(this).hide()}),a(document).off("mousemove touchmove",D),qb.on("mousemove touchmove",x),b&&h.onSelectEnd(g,p())}function z(b){return"mousedown"==b.type&&1!=b.which?!1:("touchstart"==b.type?(hb&&y(),hb=!0,w(b)):r(),Y?(db=i(zb["x"+(1+/w/.test(Y))]),eb=j(zb["y"+(1+/n/.test(Y))]),fb=i(zb["x"+(1+!/w/.test(Y))]),gb=j(zb["y"+(1+!/n/.test(Y))]),U=fb-m(b),V=gb-n(b),a(document).on("mousemove touchmove",D).one("mouseup touchend",y),qb.off("mousemove touchmove",x)):h.movable?(S=N+zb.x1-m(b),T=O+zb.y1-n(b),qb.off("mousemove touchmove",x),a(document).on("mousemove touchmove",F).one("mouseup touchend",function(){hb=!1,h.onSelectEnd(g,p()),a(document).off("mousemove touchmove",F),qb.on("mousemove touchmove",x)})):pb.mousedown(b),!1)}function A(a){bb&&(a?(fb=d(N,e(N+P,db+c(gb-eb)*bb*(fb>db||-1))),gb=f(d(O,e(O+Q,eb+c(fb-db)/bb*(gb>eb||-1)))),fb=f(fb)):(gb=d(O,e(O+Q,eb+c(fb-db)/bb*(gb>eb||-1))),fb=f(d(N,e(N+P,db+c(gb-eb)*bb*(fb>db||-1)))),gb=f(gb)))}function B(){db=e(db,N+P),eb=e(eb,O+Q),c(fb-db)<Z&&(fb=db-Z*(db>fb||-1),N>fb?db=N+Z:fb>N+P&&(db=N+P-Z)),c(gb-eb)<$&&(gb=eb-$*(eb>gb||-1),O>gb?eb=O+$:gb>O+Q&&(eb=O+Q-$)),fb=d(N,e(fb,N+P)),gb=d(O,e(gb,O+Q)),A(c(fb-db)<c(gb-eb)*bb),c(fb-db)>_&&(fb=db-_*(db>fb||-1),A()),c(gb-eb)>ab&&(gb=eb-ab*(eb>gb||-1),A(!0)),zb={x1:k(e(db,fb)),x2:k(d(db,fb)),y1:l(e(eb,gb)),y2:l(d(eb,gb)),width:c(fb-db),height:c(gb-eb)}}function C(){B(),s(),h.onSelectChange(g,p())}function D(a){return v(a)?void 0:(B(),fb=/w|e|^$/.test(Y)||bb?m(a)+U:i(zb.x2),gb=/n|s|^$/.test(Y)||bb?n(a)+V:j(zb.y2),C(),!1)}function E(b,c){fb=(db=b)+zb.width,gb=(eb=c)+zb.height,a.extend(zb,{x1:k(db),y1:l(eb),x2:k(fb),y2:l(gb)}),s(),h.onSelectChange(g,p())}function F(a){return v(a)?void 0:(db=d(N,e(S+m(a),N+P-zb.width)),eb=d(O,e(T+n(a),O+Q-zb.height)),E(db,eb),a.preventDefault(),!1)}function G(){a(document).off("mousemove touchmove",G),r(),fb=db,gb=eb,C(),Y="",tb.is(":visible")||qb.add(tb).hide().fadeIn(h.fadeDuration||0),cb=!0,a(document).off("mouseup touchend",H).on("mousemove touchmove",D).one("mouseup touchend",y),qb.off("mousemove touchmove",x),h.onSelectStart(g,p())}function H(){a(document).off("mousemove touchmove",G).off("mouseup touchend",H),u(qb.add(tb)),q(k(db),l(eb),k(db),l(eb)),this instanceof a.imgAreaSelect||(h.onSelectChange(g,p()),h.onSelectEnd(g,p()))}function I(b){return"mousedown"==b.type&&1!=b.which||tb.is(":animated")?!1:(hb="touchstart"==b.type,r(),S=db=m(b),T=eb=n(b),U=V=0,a(document).on({"mousemove touchmove":G,"mouseup touchend":H}),!1)}function J(){t(!1)}function K(){M=!0,L(h=a.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},h)),h.show&&(cb=!0,r(),s(),qb.add(tb).hide().fadeIn(h.fadeDuration||0)),setTimeout(function(){h.onInit(g,p())},0)}function L(c){if(c.parent&&(R=a(c.parent)).append(qb).append(tb),a.extend(h,c),r(),null!=c.handles){for(ub.remove(),ub=a([]),kb=c.handles?"corners"==c.handles?4:8:0;kb--;)ub=ub.add(b());ub.addClass(h.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:xb+1||1}),!parseInt(ub.css("width"))>=0&&ub.width(5).height(5)}for(W=h.imageWidth/P||1,X=h.imageHeight/Q||1,null!=c.x1&&(q(c.x1,c.y1,c.x2,c.y2),c.show=!c.hide),c.keys&&(h.keys=a.extend({shift:1,ctrl:"resize"},c.keys)),tb.addClass(h.classPrefix+"-outer"),rb.addClass(h.classPrefix+"-selection"),kb=0;kb++<4;)a(sb[kb-1]).addClass(h.classPrefix+"-border"+kb);qb.append(rb.add(sb)).append(ub),Cb&&((lb=(tb.css("filter")||"").match(/opacity=(\d+)/))&&tb.css("opacity",lb[1]/100),(lb=(sb.css("filter")||"").match(/opacity=(\d+)/))&&sb.css("opacity",lb[1]/100)),c.hide?u(qb.add(tb)):c.show&&M&&(cb=!0,qb.add(tb).fadeIn(h.fadeDuration||0),t()),bb=(jb=(h.aspectRatio||"").split(/:/))[0]/jb[1],pb.add(tb).off("mousedown touchstart",I),h.disable||h.enable===!1?(qb.off({"mousemove touchmove":x,"mousedown touchstart":z}),a(window).off("resize",J)):((h.enable||h.disable===!1)&&((h.resizable||h.movable)&&qb.on({"mousemove touchmove":x,"mousedown touchstart":z}),a(window).resize(J)),h.persistent||pb.add(tb).on("mousedown touchstart",I)),h.enable=h.disable=void 0}var M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb=a(g),qb=b(),rb=b(),sb=b().add(b()).add(b()).add(b()),tb=b(),ub=a([]),vb={left:0,top:0},wb={left:0,top:0},xb=0,yb="absolute",zb={x1:0,y1:0,x2:0,y2:0,width:0,height:0},Ab=navigator.userAgent,Bb=function(a){var b,c,f=h.keys,g=a.keyCode;if(b=isNaN(f.alt)||!a.altKey&&!a.originalEvent.altKey?!isNaN(f.ctrl)&&a.ctrlKey?f.ctrl:!isNaN(f.shift)&&a.shiftKey?f.shift:isNaN(f.arrows)?10:f.arrows:f.alt,"resize"==f.arrows||"resize"==f.shift&&a.shiftKey||"resize"==f.ctrl&&a.ctrlKey||"resize"==f.alt&&(a.altKey||a.originalEvent.altKey)){switch(g){case 37:b=-b;case 39:c=d(db,fb),db=e(db,fb),fb=d(c+b,db),A();break;case 38:b=-b;case 40:c=d(eb,gb),eb=e(eb,gb),gb=d(c+b,eb),A(!0);break;default:return}C()}else switch(db=e(db,fb),eb=e(eb,gb),g){case 37:E(d(db-b,N),eb);break;case 38:E(db,d(eb-b,O));break;case 39:E(db+e(b,P-k(fb)),eb);break;case 40:E(db,eb+e(b,Q-l(gb)));break;default:return}return!1};this.remove=function(){L({disable:!0}),qb.add(tb).remove()},this.getOptions=function(){return h},this.setOptions=L,this.getSelection=p,this.setSelection=q,this.cancelSelection=H,this.update=t;var Cb=(/msie ([\w.]+)/i.exec(Ab)||[])[1],Db=/webkit/i.test(Ab)&&!/chrome/i.test(Ab);for(ib=pb;ib.length;)xb=d(xb,isNaN(ib.css("z-index"))?xb:ib.css("z-index")),h.parent||"fixed"!=ib.css("position")||(yb="fixed"),ib=ib.parent(":not(body)");xb=h.zIndex||xb,a.imgAreaSelect.keyPress=Cb||Db?"keydown":"keypress",qb.add(tb).hide().css({position:yb,overflow:"hidden",zIndex:xb||"0"}),qb.css({zIndex:xb+2||2}),rb.add(sb).css({position:"absolute",fontSize:0}),g.complete||"complete"==g.readyState||!pb.is("img")?K():pb.one("load",K),!M&&Cb&&Cb>=7&&(g.src=g.src)},a.fn.imgAreaSelect=function(b){return b=b||{},this.each(function(){a(this).data("imgAreaSelect")?b.remove?(a(this).data("imgAreaSelect").remove(),a(this).removeData("imgAreaSelect")):a(this).data("imgAreaSelect").setOptions(b):b.remove||(void 0===b.enable&&void 0===b.disable&&(b.enable=!0),a(this).data("imgAreaSelect",new a.imgAreaSelect(this,b)))}),b.instance?a(this).data("imgAreaSelect"):this}}(jQuery);